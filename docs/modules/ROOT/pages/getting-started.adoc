= Getting Started

include::./includes/attributes.adoc[]

This guide walks you through adding the Quarkus Morphium extension to a project, configuring a
MongoDB connection, defining your first entity, and performing basic CRUD operations.

== Prerequisites

* JDK 17+
* Apache Maven 3.9+
* A running MongoDB instance (or just use <<dev-services,Dev Services>> — no setup needed)

== Installation

Add the extension to your `pom.xml`:

[source,xml,subs=attributes+]
----
<dependency>
    <groupId>io.quarkiverse.morphium</groupId>
    <artifactId>quarkus-morphium</artifactId>
    <version>{quarkus-morphium-version}</version>
</dependency>
----

NOTE: Until the extension is published to Maven Central, build it locally with
`mvn install -DskipTests` and use version `{quarkus-morphium-version}`.

== Minimal Configuration

Create `src/main/resources/application.properties` with a single required property:

[source,properties]
----
quarkus.morphium.database=my-database
----

That's it. In dev and test mode, Dev Services automatically starts a MongoDB container — no
Docker configuration needed. For all configuration options see
xref:configuration.adoc[Configuration Reference].

== Define an Entity

[source,java]
----
import de.caluga.morphium.annotations.*;
import de.caluga.morphium.annotations.lifecycle.*;
import java.time.Instant;

@Entity(collectionName = "products")
@Lifecycle
public class ProductEntity {

    @Id
    private String id;

    @Property(fieldName = "name")
    private String name;

    @Property(fieldName = "price")
    private double price;

    @Version
    @Property(fieldName = "version")
    private long version;

    @Property(fieldName = "created_at")
    private Instant createdAt;

    @PreStore
    public void onStore() {
        if (createdAt == null) createdAt = Instant.now();
    }

    // getters / setters
}
----

Every class annotated with `@Entity` or `@Embedded` is automatically registered for GraalVM
reflection at build time — no manual `reflect-config.json` required.

For a complete guide to annotations see xref:entities.adoc[Entities & Annotations].

== Inject Morphium

[source,java]
----
import de.caluga.morphium.Morphium;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.inject.Inject;
import java.util.List;
import java.util.Optional;

@ApplicationScoped
public class ProductRepository {

    @Inject
    Morphium morphium;

    public ProductEntity save(ProductEntity product) {
        morphium.store(product);   // sets id and version in-place
        return product;
    }

    public Optional<ProductEntity> findByName(String name) {
        return Optional.ofNullable(
            morphium.createQueryFor(ProductEntity.class)
                .f("name").eq(name)
                .get()
        );
    }

    public List<ProductEntity> findAll() {
        return morphium.createQueryFor(ProductEntity.class).asList();
    }

    public void delete(ProductEntity product) {
        morphium.delete(product);
    }
}
----

The `Morphium` instance is a CDI `@ApplicationScoped` bean — the extension manages its full
lifecycle (connection setup, shutdown, hot-reload cache clearing).

[[dev-services]]
== Dev Services

When you run `quarkus dev` or execute tests, the extension automatically starts a MongoDB
Docker container. No manual Docker setup is needed. See xref:dev-services.adoc[Dev Services]
for details.

== Next Steps

* xref:configuration.adoc[Configuration Reference] — all `quarkus.morphium.*` properties
* xref:entities.adoc[Entities & Annotations] — `@Entity`, `@Embedded`, `@Id`, `@Version`, lifecycle hooks
* xref:transactions.adoc[Transactions] — declarative `@MorphiumTransactional`
* xref:dev-services.adoc[Dev Services] — automatic MongoDB container, replica-set mode
* xref:health-checks.adoc[Health Checks] — MicroProfile Health probes
* xref:testing.adoc[Testing] — Dev Services vs. InMemDriver strategies
* xref:advanced.adoc[Advanced Topics] — SSL/TLS, Atlas SRV, GraalVM native
